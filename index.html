<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Seat Map</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- üîí CH·ªà XEM ‚Äì KH√ÅCH -->
<script>
  window.VIEW_ONLY = true;
</script>

<div class="top-header">
  LI√äN ƒêO√ÄN XI·∫æC VI·ªÜT NAM & NH√Ä H√ÅT S√ÇN KH·∫§U TRUY·ªÄN TH·ªêNG QU·ªêC GIA VI·ªÜT NAM
</div>

<!-- ===== TRANG CH·ªåN NG√ÄY ===== -->
<div id="mapSelect">

  <h2 class="map-title">
    S∆† ƒê·ªí GH·∫æ V·ªû DI·ªÑN
    <span>TR·∫¶N NH√ÇN T√îNG</span>
  </h2>

  <!-- DANH S√ÅCH NG√ÄY (LOAD T·ª™ FIREBASE) -->
  <div class="map-btn-group" id="dayList"></div>

</div>

<!-- ===== S∆† ƒê·ªí GH·∫æ ===== -->
<div class="layout" id="mainLayout" style="display:none">

  <div class="hall">

    <div class="stage">S√ÇN KH·∫§U</div>
    <div class="entrance">C·ª¨A V√ÄO ‚Üí</div>

    <div class="seat-wrapper" id="seatWrapper"></div>

    <div class="row bottom">
      <div class="row-label">N</div>
      <div class="bottom-row" id="bottomRow"></div>
      <div class="row-label">N</div>
    </div>

  </div>

  <div class="ticket-list">
    <div class="ticket-title">H·∫†NG V√â</div>

    <div class="ticket-card">
      <div class="ticket-badge standard">STANDARD</div>
      <div>
        <div class="ticket-name">STANDARD</div>
        <div class="ticket-price">300,000ƒë</div>
        <div class="ticket-note">Ch·ªçn t·ª´ s∆° ƒë·ªì gh·∫ø</div>
      </div>
    </div>

    <div class="ticket-card">
      <div class="ticket-badge vip">VIP</div>
      <div>
        <div class="ticket-name">VIP</div>
        <div class="ticket-price">400,000ƒë</div>
        <div class="ticket-note">Ch·ªçn t·ª´ s∆° ƒë·ªì gh·∫ø</div>
      </div>
    </div>
  </div>

</div>

<!-- ===== FIREBASE ===== -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDhxpZNFqRmP00SinKIrJm9yiks65GMWfU",
    authDomain: "seats-44179.firebaseapp.com",
    databaseURL: "https://seats-44179-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "seats-44179",
    storageBucket: "seats-44179.appspot.com",
    messagingSenderId: "676842315110",
    appId: ""
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<script>
/* ================== 3 NG√ÄY G·ªêC ‚Äì GI·ªÆ NGUY√äN ================== */
const DEFAULT_DAYS = [
  "2026-01-31",
  "2026-02-14",
  "2026-02-28"
];

/* ================== ƒê·∫¢M B·∫¢O NG√ÄY G·ªêC LU√îN T·ªíN T·∫†I ================== */
DEFAULT_DAYS.forEach(day => {
  db.ref("maps/" + day).get().then(snap => {
    if (!snap.exists()) {
      db.ref("maps/" + day).set(true);
    }
  });
});

/* ================== LOAD DANH S√ÅCH NG√ÄY ================== */
const dayList = document.getElementById("dayList");

db.ref("maps").on("value", snap => {
  dayList.innerHTML = "";

  if (!snap.exists()) {
    dayList.innerHTML = "<p>Ch∆∞a c√≥ ng√†y di·ªÖn</p>";
    return;
  }

  const days = Object.keys(snap.val()).sort();

  days.forEach(day => {
    const btn = document.createElement("button");
    btn.className = "map-btn";

    const [y, m, d] = day.split("-");
    btn.innerText = `${d} - ${m} - ${y}`;

    btn.onclick = () => selectMap(day);
    dayList.appendChild(btn);
  });
});
</script>

<script>
function selectMap(key) {
  window.MAP_KEY = key;

  history.pushState({ map: key }, "", "#map-" + key);

  document.getElementById("mapSelect").style.display = "none";
  document.getElementById("mainLayout").style.display = "flex";

  initSeatMap();
}

window.addEventListener("popstate", function (e) {
  if (!e.state || !e.state.map) {
    document.getElementById("mainLayout").style.display = "none";
    document.getElementById("mapSelect").style.display = "block";
    window.MAP_KEY = null;
    return;
  }

  window.MAP_KEY = e.state.map;
  document.getElementById("mapSelect").style.display = "none";
  document.getElementById("mainLayout").style.display = "flex";
  initSeatMap();
});
</script>

<div class="bottom-footer">
  TRUNG T√ÇM NGH·ªÜ THU·∫¨T - GI·∫¢I TR√ç IONAH / 67 - 69, TR·∫¶N NH√ÇN T√îNG, HAI B√Ä TR∆ØNG, H√Ä N·ªòI
</div>

<script src="script.js"></script>
</body>
</html>
