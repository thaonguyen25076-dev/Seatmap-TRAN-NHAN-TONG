<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Seat Map Admin</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- ===== TRANG CH√çNH ===== -->
<div id="homePage" class="home-page">

  <h1 class="home-title">
    C√ÅC V·ªû DI·ªÑN T·∫†I TRUNG T√ÇM NGH·ªÜ THU·∫¨T & GI·∫¢I TR√ç IONAH
  </h1>

<div class="home-container">

  <!-- ===== V·ªû 1 ===== -->
  <div class="show-card">
    <img src="KV.jpg">

    <div class="show-info">
      <div class="show-title">TR·∫¶N NH√ÇN T√îNG</div>
      <div class="show-sub">V·ªü Xi·∫øc k·∫øt h·ª£p C·∫£i L∆∞∆°ng</div>

      <button class="show-btn" onclick="openShow('tran')">
        S∆† ƒê·ªí GH·∫æ
      </button>
    </div>
  </div>

  <!-- ===== V·ªû 2 ===== -->
  <div class="show-card">
    <img src="BG.jpg">

    <div class="show-info">
      <div class="show-title">9/3</div>
      <div class="show-sub">V·ªü Xi·∫øc k·∫øt h·ª£p C·∫£i L∆∞∆°ng</div>

      <button class="show-btn" onclick="openShow('show2')">
        S∆† ƒê·ªí GH·∫æ
      </button>
    </div>
  </div>

</div>

  </div>
</div>
<div class="top-header">
  LI√äN ƒêO√ÄN XI·∫æC VI·ªÜT NAM & NH√Ä H√ÅT S√ÇN KH·∫§U TRUY·ªÄN TH·ªêNG QU·ªêC GIA VI·ªÜT NAM
</div>

<!-- ===== TRANG CH·ªåN MAP ===== -->
<div id="mapSelect" style="display:none">
  <h2 class="map-title">
    S∆† ƒê·ªí GH·∫æ V·ªû DI·ªÑN
    <span>TR·∫¶N NH√ÇN T√îNG</span>
  </h2>

  <div class="map-btn-group" id="mapBtnGroup">
    <button class="map-btn" onclick="selectMap('2026-01-31')">31 - 01 - 2026</button>
    <button class="map-btn" onclick="selectMap('2026-02-14')">14 - 03 - 2026</button>
    <button class="map-btn" onclick="selectMap('2026-02-28')">28 - 03 - 2026</button>
  </div>

  <!-- N√öT T·∫†O NG√ÄY -->
  <button class="map-btn" style="background:#2ecc71" onclick="openCreateDay()">
    T·∫†O NG√ÄY DI·ªÑN
  </button>
</div>

<!-- ===== S∆† ƒê·ªí GH·∫æ ===== -->
<div class="layout" id="mainLayout" style="display:none">
  <div class="hall">
    <div class="reset-map">
      <button id="resetSeatsBtn">RESET MAP</button>
      <button onclick="deleteCurrentDay()" style="
  padding:10px 16px;
  margin-top:8px;
  background:#555;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
">
   X√ìA NG√ÄY DI·ªÑN
</button>

    </div>

    <div class="stage">S√ÇN KH·∫§U</div>
    <div class="entrance">C·ª¨A V√ÄO ‚Üí</div>
    <div class="seat-wrapper" id="seatWrapper"></div>

    <div class="row bottom">
      <div class="row-label">N</div>
      <div class="bottom-row" id="bottomRow"></div>
      <div class="row-label">N</div>
    </div>
  </div>

  <div class="ticket-list">
    <div class="ticket-title">H·∫†NG V√â</div>

    <div class="ticket-card">
      <div class="ticket-badge standard">STANDARD</div>
      <div>
        <div class="ticket-name">STANDARD</div>
        <div class="ticket-price">300,000ƒë</div>
        <div class="ticket-note">Ch·ªçn t·ª´ s∆° ƒë·ªì gh·∫ø</div>
      </div>
    </div>

    <div class="ticket-card">
      <div class="ticket-badge vip">VIP</div>
      <div>
        <div class="ticket-name">VIP</div>
        <div class="ticket-price">400,000ƒë</div>
        <div class="ticket-note">Ch·ªçn t·ª´ s∆° ƒë·ªì gh·∫ø</div>
      </div>
    </div>
  </div>
</div>

<!-- ===== FIREBASE ===== -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDhxpZNFqRmP00SinKIrJm9yiks65GMWfU",
    authDomain: "seats-44179.firebaseapp.com",
    databaseURL: "https://seats-44179-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "seats-44179",
    storageBucket: "seats-44179.appspot.com",
    messagingSenderId: "676842315110",
    appId: ""
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<!-- ===== LOAD DANH S√ÅCH NG√ÄY ===== -->
<script>
const mapGroup = document.getElementById("mapBtnGroup");

db.ref("maps").on("value", snap => {
  mapGroup.innerHTML = `
    <button class="map-btn" onclick="selectMap('2026-01-31')">31 - 01 - 2026</button>
    <button class="map-btn" onclick="selectMap('2026-02-14')">14 - 03 - 2026</button>
    <button class="map-btn" onclick="selectMap('2026-02-28')">28 - 03 - 2026</button>
  `;

  snap.forEach(s => {
    const d = s.key;
    if (
      d === "2026-01-31" ||
      d === "2026-02-14" ||
      d === "2026-02-28"
    ) return;

    const btn = document.createElement("button");
    btn.className = "map-btn";
    btn.textContent = d.split("-").reverse().join(" - ");
    btn.onclick = () => selectMap(d);
    mapGroup.appendChild(btn);
  });
});
</script>

<!-- ===== CH·ªåN MAP ===== -->
<script>
function selectMap(key) {
  window.MAP_KEY = key;

  history.pushState({ map: key }, "", "#map-" + key);

  document.getElementById("mapSelect").style.display = "none";
  document.getElementById("mainLayout").style.display = "flex";

  // üëâ lu√¥n hi·ªán n√∫t th·ªëng k√™
  document.getElementById("statBtn").style.display = "block";

  initSeatMap();
  updateTicketUI();

  // üëâ ch·ªçn h√†m th·ªëng k√™ theo v·ªü
  if (key === "show2") {
    updateStatShow2(); // üëà m·ªõi
  } else {
    updateStat(); // üëà c≈©
  }
}
</script>

<!-- ===== POPSTATE ===== -->
<script>
window.addEventListener("popstate", e => {
  if (!e.state || !e.state.map) {
    document.getElementById("mainLayout").style.display = "none";
    document.getElementById("mapSelect").style.display = "block";
    document.getElementById("statBtn").style.display = "block";
    document.getElementById("statBtn").style.display = "none";

    window.MAP_KEY = null;
    return;
  }

  window.MAP_KEY = e.state.map;
  document.getElementById("mapSelect").style.display = "none";
  document.getElementById("mainLayout").style.display = "flex";
  initSeatMap();
});
</script>

<!-- ===== FOOTER ===== -->
<div class="bottom-footer">
  TRUNG T√ÇM NGH·ªÜ THU·∫¨T - GI·∫¢I TR√ç IONAH / 67 - 69, TR·∫¶N NH√ÇN T√îNG, H√Ä N·ªòI
</div>

<!-- ===== N√öT TH·ªêNG K√ä ===== -->
 
<div id="statBtn" class="stat-btn" onclick="openStat()" style="display:none">
  TH·ªêNG K√ä B√ÅN V√â
</div>
<!-- ===== POPUP TH·ªêNG K√ä ===== -->
<div id="statModal" class="stat-modal" style="display:none">
  <div class="stat-box">
    <!-- TH·ªêNG K√ä CHUNG -->
<div id="statNormal">
  <div class="stat-row">V√© VIP: <b id="vipCount">0</b> v√©</div>
  <div class="stat-row">V√© Th∆∞·ªùng: <b id="normalCount">0</b> v√©</div>
  <div class="stat-row">Gh·∫ø ƒë√£ b√°n: <b id="soldCount">0</b> gh·∫ø</div>
  <div class="stat-row">Gh·∫ø c√≤n t·ªìn: <b id="remainCount">0</b> gh·∫ø</div>
  <div class="stat-row">T·ªâ l·ªá l·∫•p: <b id="fillRate">0</b>%</div>
</div>

<!-- TH·ªêNG K√ä RI√äNG 9/3 -->
<div id="statABC" style="display:none;">
  <div class="stat-row">V√© A: <b id="vipCount_93">0</b> v√©</div>
  <div class="stat-row">V√© B: <b id="normalCount_93">0</b> v√©</div>
  <div class="stat-row">V√© C: <b id="cCount_93">0</b> v√©</div>
  <div class="stat-row">Gh·∫ø ƒë√£ b√°n: <b id="soldCount_93">0</b> gh·∫ø</div>
</div>
    <hr>

    <div class="stat-row">Ti·ªÅn v√© VIP: <b id="vipMoney">0</b> ƒë</div>
    <div class="stat-row">Ti·ªÅn v√© th∆∞·ªùng: <b id="normalMoney">0</b> ƒë</div>

    <div class="stat-total">
      T·ªîNG: <span id="totalMoney">0</span> ƒë
    </div>

    <button onclick="closeStat()">ƒê√ìNG</button>
  </div>
</div>


<!-- ===== POPUP T·∫†O NG√ÄY ===== -->
<div id="createDayModal" class="stat-modal" style="display:none">
  <div class="stat-box">
    <h3>T·∫†O NG√ÄY DI·ªÑN</h3>
    <input type="date" id="newDay" style="width:100%;padding:10px;margin-bottom:12px">
    <button onclick="createDay()" style="background:#27ae60">T·∫†O</button>
    <button onclick="closeCreateDay()">H·ª¶Y</button>
  </div>
</div>

<script>
function openCreateDay() {
  document.getElementById("createDayModal").style.display = "flex";
}
function closeCreateDay() {
  document.getElementById("createDayModal").style.display = "none";
}
function createDay() {
  const date = document.getElementById("newDay").value;
  if (!date) return alert("Vui l√≤ng ch·ªçn ng√†y");
  db.ref("maps/" + date).set(true);
  closeCreateDay();
}
</script>
<script>
function deleteCurrentDay() {
  if (!window.MAP_KEY) {
    alert("Ch∆∞a ch·ªçn ng√†y!");
    return;
  }

  if (!confirm("X√ìA TO√ÄN B·ªò NG√ÄY DI·ªÑN N√ÄY?\nGh·∫ø + d·ªØ li·ªáu s·∫Ω m·∫•t vƒ©nh vi·ªÖn!")) {
    return;
  }

  const day = window.MAP_KEY;

  // x√≥a map ng√†y
  db.ref("maps/" + day).remove();

  // x√≥a to√†n b·ªô gh·∫ø c·ªßa ng√†y ƒë√≥
  db.ref("seats/" + day).remove();

  alert("ƒê√£ x√≥a ng√†y di·ªÖn!");

  // quay v·ªÅ m√†n ch·ªçn ng√†y
  window.MAP_KEY = null;
  document.getElementById("mainLayout").style.display = "none";
  document.getElementById("mapSelect").style.display = "block";
  history.pushState({}, "", location.pathname);
}
</script>
<script>
function openStat() {
  document.getElementById("statModal").style.display = "flex";

  if (window.MAP_KEY === "show2") {
    updateStatShow2();
  } else {
    updateStat();
  }
}

function closeStat() {
  document.getElementById("statModal").style.display = "none";
}
</script>
<script>
function enterSeatMap() {
  document.getElementById("homePage").style.display = "none";
  document.getElementById("mapSelect").style.display = "block";
}
</script>
<script>
function openShow(type) {
  document.getElementById("homePage").style.display = "none";

  // ===== TR·∫¶N NH√ÇN T√îNG =====
  if (type === "tran") {
    window.MAP_KEY = null;
    document.getElementById("mapSelect").style.display = "block";
  }

  // ===== V·ªû 9/3 =====
  if (type === "show2") {
    document.getElementById("mapSelect").style.display = "none";
    document.getElementById("mainLayout").style.display = "flex";

    window.MAP_KEY = "show2";

    // üî• TH√äM D√íNG N√ÄY
    document.getElementById("statBtn").style.display = "block";

    updateTicketUI();
    initSeatMap();
  }
}
</script>
</script>
<script src="script.js"></script>
</body>
</html>